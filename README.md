
# üìö Library API ‚Äî FastAPI + JWT + Alembic

RESTful API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–º –∫–∞—Ç–∞–ª–æ–≥–æ–º: –∫–Ω–∏–≥–∏, —á–∏—Ç–∞—Ç–µ–ª–∏, –≤—ã–¥–∞—á–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç.  
–ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é –¥–ª—è —Å—Ç–∞–∂–µ—Ä–∞ Python-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
git clone https://github.com/MadiKaliyev/library.git
cd library
python -m venv venv
source venv/bin/activate        # Windows: venv\Scripts\activate
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
uvicorn app.main:app --reload
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite (—Ñ–∞–π–ª `library.db` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

---

## üë§ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—è

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ Swagger UI: [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)
2. –í—ã–∑–≤–∞—Ç—å `POST /auth/register`:
```json
{
  "email": "admin@example.com",
  "password": "123456"
}
```
3. –ó–∞—Ç–µ–º `POST /auth/login` –∏ –≤—Å—Ç–∞–≤–∏—Ç—å `access_token` —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É **Authorize**.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ api/         # –ú–∞—Ä—à—Ä—É—Ç—ã (auth, books, readers, borrowed)
‚îú‚îÄ‚îÄ crud/        # CRUD-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ models/      # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ schemas/     # Pydantic-—Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ core/        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ database/    # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ main.py      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
alembic/         # –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic
.env             # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

---

## üß± –ü—Ä–∏–Ω—è—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- `users`: –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä–∏, –∞–≤—Ç–æ—Ä–∏–∑—É—é—Ç—Å—è –ø–æ email/password
- `books`: –∫–Ω–∏–≥–∞ —Å –ø–æ–ª—è–º–∏ title, author, year, isbn, count, description
- `readers`: —á–∏—Ç–∞—Ç–µ–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—è–º–∏
- `borrowed_books`: —Å–≤—è–∑–∏ –∫–Ω–∏–≥ –∏ —á–∏—Ç–∞—Ç–µ–ª–µ–π —Å –¥–∞—Ç–∞–º–∏ –≤—ã–¥–∞—á–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OAuth2 + JWT:
- `python-jose` –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- `passlib[bcrypt]` –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- –í—Å–µ `CRUD`-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã `Depends(get_current_user)`
- –¢–æ–ª—å–∫–æ `/auth/register` –∏ `/auth/login` ‚Äî –ø—É–±–ª–∏—á–Ω—ã–µ

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic

1. –ü–µ—Ä–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è ‚Äî `create initial tables`
2. –í—Ç–æ—Ä–∞—è –º–∏–≥—Ä–∞—Ü–∏—è ‚Äî `add description to books`

```bash
alembic revision --autogenerate -m "create initial tables"
alembic upgrade head

alembic revision --autogenerate -m "add description to books"
alembic upgrade head
```

---

## üìä –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

**4.1. –í—ã–¥–∞—á–∞ –∫–Ω–∏–≥–∏ (`/borrowed/borrow`)**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ `book.count > 0`
- –£ —á–∏—Ç–∞—Ç–µ–ª—è –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª–µ–µ 3 –∫–Ω–∏–≥

**4.2. –í–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥–∏ (`/borrowed/return`)**
- –ù–µ–ª—å–∑—è –≤–µ—Ä–Ω—É—Ç—å –∫–Ω–∏–≥—É –¥–≤–∞–∂–¥—ã
- –ö–æ–ª-–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `return_date`

**4.3. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–Ω–∏–≥ —á–∏—Ç–∞—Ç–µ–ª—è (`/borrowed/reader/{reader_id}`)**
- –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–Ω–∏–≥–∏ –±–µ–∑ `return_date`

**–°–ª–æ–∂–Ω–æ—Å—Ç–∏:** —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–∏–≥ —É —á–∏—Ç–∞—Ç–µ–ª—è, –ª–æ–≥–∏–∫–∞ –≤–ª–æ–∂–µ–Ω–∞ –≤ `crud/borrowed.py`.

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä –∑–∞—â–∏—â—ë–Ω–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞

```bash
POST /books/
Authorization: Bearer <–≤–∞—à —Ç–æ–∫–µ–Ω>
Content-Type: application/json

{
  "title": "–ö–∞–ø–∏—Ç–∞–Ω—Å–∫–∞—è –¥–æ—á–∫–∞",
  "author": "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ü—É—à–∫–∏–Ω"
}
```

---

## ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ PEP8 –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

- –í—Å–µ –º–æ–¥—É–ª–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é (CRUD, –º–æ–¥–µ–ª–∏, —Å—Ö–µ–º—ã, API)
- –¢–∏–ø–∏–∑–∞—Ü–∏—è –∏ `from_attributes = True` –¥–ª—è Pydantic v2
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `.env` –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ Swagger UI

---

## ‚úÖ –û—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã

- `üéâ Initial commit`
- `üîê Add auth and user creation`
- `üìö Add book model and logic`
- `üõ†Ô∏è Alembic initial migration`
- `‚ú® Add description field to books`

---

## ‚ú® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏—á–∞ (–∏–¥–µ—è)

**–ê–≤—Ç–æ–æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∞—Ö:**  
–î–æ–±–∞–≤–∏—Ç—å `due_date` + —Ñ–æ–Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏ –∏ —Å—Ç–∞–≤–∏—Ç —Ñ–ª–∞–≥ `overdue = True`. –≠—Ç–æ –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ email.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Pytest)

–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª `tests/test_logic.py`:
- –ø–æ–ø—ã—Ç–∫–∞ –≤–∑—è—Ç—å 4 –∫–Ω–∏–≥–∏
- –≤—ã–¥–∞—á–∞ –∫–Ω–∏–≥–∏ —Å `count = 0`
- –≤–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥–∏ –¥–≤–∞–∂–¥—ã

üìå –¢–µ—Å—Ç—ã –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–∞–∫:

```bash
pytest
```

---

## üßæ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License ‚Äî —Å–≤–æ–±–æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è—Ö.  
–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: **2025-05-18**
